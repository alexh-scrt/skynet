# Reference Stripping Configuration

## Overview
By default, Barbie no longer logs source references (References, Sources, Citations) to conversation logs. This keeps the conversation logs cleaner and more focused on the actual dialog content.

## Configuration

### Environment Variable
- **Variable**: `LOG_REFERENCES`
- **Default**: `false` (references are stripped)
- **Options**: `true` or `false`

### How to Enable Reference Logging
If you want to include references in conversation logs, set the environment variable:
```bash
export LOG_REFERENCES=true
```

Or in your `.env` file:
```
LOG_REFERENCES=true
```

## What Gets Stripped (When LOG_REFERENCES=false)

1. **Reference Sections**: Any section starting with "References:", "Sources:", or "Citations:"
2. **Bold Reference Headers**: Sections like "**References:**"
3. **Individual Citations**: Standalone citation lines (e.g., "Smith, J. (2024). Title. Journal, 1(1), 1-10.")
4. **Closing Phrases**: "Looking forward to..." type phrases

## Implementation Details

### Files Modified
- `barbie.py`:
  - Added `self.log_references` configuration flag (line 149)
  - Added `strip_references()` method (lines 170-196)
  - Updated `ensure_message_logged()` to call `strip_references()` (line 122)
  - Updated `log_conversation_message()` to call `strip_references()` (line 234)

### How It Works
1. Messages are processed through `strip_thinking_content()` first (removes `<think>` tags)
2. Then processed through `strip_references()` (removes references if configured)
3. Finally logged to the conversation file

## Example

### Original Message (as generated by LLM):
```
Thank you for your thoughtful feedback, Ken! I appreciate your insights.

The study on AI consciousness shows promising results for future development.

References:
Barocas, S., Hardt, M., & Narayanan, A. (2019). Fairness and machine learning. Nature Machine Intelligence, 1(1), 44-48.
European Commission. (2020). Horizon 2020: The EU Framework Programme for Research and Innovation.

Looking forward to your response!
```

### Logged Message (with LOG_REFERENCES=false, default):
```
Thank you for your thoughtful feedback, Ken! I appreciate your insights.

The study on AI consciousness shows promising results for future development.
```

### Logged Message (with LOG_REFERENCES=true):
The full message including references would be logged.

## Testing
Run the test file to verify the functionality:
```bash
conda activate skynet
python tests/test_reference_stripping.py
```

## Future Considerations
The reference stripping functionality is preserved and can be easily re-enabled by setting the environment variable. This allows for flexibility if references need to be included in logs for specific use cases or debugging purposes.